{
   "codePost": null,
   "virtualDomainRoles": [
      {
         "allowGet": true,
         "allowPost": false,
         "allowPut": true,
         "roleName": "ALLROLES",
         "allowDelete": false
      }
   ],
   "codePut": "DECLARE\r\n    attachments_count       NUMBER;\r\n    max_attachments_count   NUMBER;\r\n    status_id               NUMBER;\r\n    review_required_ind     VARCHAR2(1);\r\n    default_review_code     VARCHAR2(10);\r\n    user_id                 VARCHAR2(9);\r\n    user_action_item_id     NUMBER(19);\r\nBEGIN\r\n-- Get User Action Item ID\r\n    SELECT\r\n        gcraact_surrogate_id\r\n    INTO\r\n        user_action_item_id\r\n    FROM\r\n        gcraact\r\n    WHERE\r\n        gcraact_pidm =:parm_user_pidm\r\n        AND   gcraact_gcbactm_id =:id\r\n        AND   ( trunc(SYSDATE) BETWEEN trunc(gcraact_display_start_date) AND trunc(gcraact_display_end_date) );\r\n--Get the admin configurations for selected response\r\n\r\n    SELECT\r\n        gcraisr_allowed_attachment,\r\n        gcraisr_gcvasts_id,\r\n        gcraisr_rev_req_ind\r\n    INTO\r\n        max_attachments_count,status_id,review_required_ind\r\n    FROM\r\n        gcraisr\r\n    WHERE\r\n        gcraisr_surrogate_id =:STATUS_RULE_ID;\r\n-- Check If the response requires attachments.\r\n\r\n    IF\r\n        ( max_attachments_count > 0 )\r\n    THEN\r\n        SELECT\r\n            COUNT(gcraflu_surrogate_id)\r\n        INTO\r\n            attachments_count\r\n        FROM\r\n            gcraflu\r\n        WHERE\r\n            gcraflu_gcraact_id = user_action_item_id\r\n            AND   gcraflu_gcraisr_id =:STATUS_RULE_ID;\r\n            \r\n--If response requires attachments, then check if user has uploaded at least one attachment. If not throw exception.\r\n\r\n        IF\r\n            ( attachments_count < 1 )\r\n        THEN\r\n            raise_application_error(-20001,'@USERMESSAGE:The selected response requires at least one attachment.');\r\n        END IF;\r\n    END IF;\r\n-- Get the default review state\r\n\r\n    IF\r\n        ( review_required_ind = 'Y' )\r\n    THEN\r\n        SELECT\r\n            gcrrvsd_rvst_code\r\n        INTO\r\n            default_review_code\r\n        FROM\r\n            gcrrvsd;\r\n\r\n    END IF;\r\n-- Get the spriden ID for the logged in user.\r\n    SELECT\r\n        spriden_id\r\n    INTO\r\n        user_id\r\n    FROM\r\n        spriden\r\n    WHERE\r\n        spriden_pidm =:parm_user_pidm\r\n        AND   spriden_change_ind IS NULL;\r\n-- Update the GCRAACT table with the selected response. Cannot update when review is ongoing for the selected action item.\r\n\r\n    UPDATE gcraact\r\n        SET\r\n            gcraact_gcvasts_id = status_id,\r\n            gcraact_gcraisr_id =:STATUS_RULE_ID,\r\n            gcraact_user_response_date = SYSDATE,\r\n            gcraact_rvst_code = default_review_code,\r\n            gcraact_activity_date = current_timestamp,\r\n            gcraact_user_id = user_id\r\n    WHERE\r\n        gcraact_surrogate_id = user_action_item_id\r\n        AND   (\r\n            gcraact_rvst_code IS NULL\r\n            OR    gcraact_rvst_code = (\r\n                SELECT\r\n                    gcrrvst_rvst_code\r\n                FROM\r\n                    gcrrvst\r\n                WHERE\r\n                    gcrrvst_review_ongoing_ind = 'N'\r\n                    AND   gcraact_rvst_code = gcrrvst_rvst_code\r\n                GROUP BY\r\n                    gcrrvst_rvst_code\r\n            )\r\n        );\r\n\r\nEND;",
   "fileTimestamp": "2018-12-23T10:43:14Z",
   "codeDelete": null,
   "codeGet": "SELECT\r\n    action_item_id \"id\",\r\n    action_item_title,\r\n    action_item_content,\r\n    (\r\n        SELECT\r\n            COUNT(status_id)\r\n        FROM\r\n            gvq_gcraisr\r\n        WHERE\r\n            status_rule_action_item_id =:actionitemid\r\n            AND   status_active_ind = 'Y'\r\n    ) status_count,\r\n    (\r\n        SELECT\r\n            gcraact_gcraisr_id\r\n        FROM\r\n            gcraact\r\n        WHERE\r\n            gcraact_gcbactm_id =:actionitemid\r\n            AND   gcraact_pidm =:parm_user_pidm\r\n            AND   trunc(current_date) BETWEEN trunc(gcraact_display_start_date) AND trunc(gcraact_display_end_date)\r\n    ) AS status_rule_id\r\nFROM\r\n    gvq_gcbactm\r\nWHERE\r\n    action_item_page_name =:pageid\r\n    AND   action_item_id =:actionitemid",
   "typeOfCode": "S",
   "serviceName": "ActionItemContent"
}